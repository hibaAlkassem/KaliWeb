function showModal(e){monitorId=e.attr("data-id"),permission=parseInt(e.attr("p-id")),$("#txtFirstName, #txtLastName, #txtPatientId").unbind("focusin"),$("#txtFirstName, #txtLastName, #txtPatientId").unbind("keyup"),"pEdit"==e.attr("id")?(modalHeaderTxt="Patient",modalViewed="edit",$("#btnSaveEdit").show(),$("#releaseDevice").show(),$("#txtDeviceId").attr("disabled",!0),resetModal(),"false"==e.attr("assigned")&&$(".release-device").hide(),6!=permission&&5!=permission&&0!=permission&&($("#prescription :input").attr("disabled",!0),$("#prescription").attr("disabled",!0),$("#prescription").find("span").css("pointer-events","none"),$("#prescription").find("#releaseDevice").css("pointer-events","none"),$("#prescription").find(".clockpicker-clock-icon").attr("style","background-color : #F4F4F4")),$("#patientModal").modal("show"),mid=e.data("id"),getMonitorPermissions(mid)):"btn-new-monitor"==e.attr("id")&&(modalViewed="assign",modalHeaderTxt="New Patient",$("#patientNumber").html(""),$("#txtDeviceId").attr("disabled",!1),$("#releaseDevice").hide(),resetModal(),$("#patientModal").modal("show"),$("#patientName").html(modalHeaderTxt),angular.element($("#txtPatientId")).triggerHandler("input"),$("#dash").html("")),$("#txtFirstName, #txtLastName, #txtPatientId").on("keyup",function(){$("#patientName").html($("#txtFirstName").val()+" "+$("#txtLastName").val()+" "),$("#patientNumber").html($("#txtPatientId").val()),""!=$("#txtPatientId").val()&&$("#dash").html(" - "),""==$("#txtFirstName").val()&&""==$("#txtLastName").val()&&""==$("#txtPatientId").val()&&$("#dash").html(""),""==$("#txtFirstName").val()&&""==$("#txtLastName").val()&&$("#dash").html("")}),$("#txtFirstName, #txtLastName, #txtPatientId").focusin(function(){""==$("#txtFirstName").val()&&""==$("#txtLastName").val()&&""==$("#txtPatientId").val()&&($("#dash").html(""),$("#patientName").html(modalHeaderTxt),""!=$("#txtPatientId").val()&&$("#dash").html(" - "))})}function resetModal(){$(".patient-modal input").val(""),$(".patient-modal .error").hide(),$("#selectGender").select2("val","0"),$("#profileBtn").click(),$(".added-time").each(function(){$(this).remove()}),$(".time-error").each(function(){$(this).removeClass("time-error"),$(this).next().removeClass("time-error-span")}),$("#prescription :input").attr("disabled",!1),$("#prescription").find("span").css("pointer-events","auto"),$("#prescription").find("#releaseDevice").css("pointer-events","auto"),$("#prescription").find(".clockpicker-clock-icon").attr("style","background-color : white"),$(".clockpicker ").clockpicker({autoclose:!0}),$(".release-device").show()}function validateTime(e){var t=e.split(":");return/^\d\d:\d\d$/.test(e)&&t[0]>=0&&t[0]<24&&t[1]>=0&&t[1]<60}function addNotification(e,t,i){var a={};a.email='<div class="row notification notification-email">                            <div class="reminder col-md-12">                                <img src="images/email.png" class="icon-email" />                                <div class="notification-txt"><b>'+e+"</b> by <b>email</b> to <b>"+i+'</b>                                </div>                                <img src="images/times-circle.png" class="icon-remove remove-notification" />                                <img src="images/pencil.png" class="icon-edit" />                            </div>                        </div>',a.phone='<div class="row notification notification-phone">                            <div class="reminder col-md-12">                                <img src="images/phone.png" class="icon-phone" />                                <div class="notification-txt"><b>'+e+"</b> by <b>phone</b> to <b>"+i+'</b>                                </div>                                <img src="images/times-circle.png" class="icon-remove remove-notification" />                                <img src="images/pencil.png" class="icon-edit" />                            </div>                        </div>',a.sms='<div class="row notification notification-sms">                            <div class="reminder col-md-12">                                <img src="images/sms.png" class="icon-sms" />                                <div class="notification-txt"><b>'+e+"</b> by <b>SMS</b> to <b>"+i+'</b>                                </div>                                <img src="images/times-circle.png" class="icon-remove remove-notification" />                                <img src="images/pencil.png" class="icon-edit" />                            </div>                        </div>',$("#notificationList").append(a[t]),$("#recipient").val(""),$("#notificationType").select2("val","Medication Reminders"),$("#notifyBy").select2("val","sms")}function getMonitorDetails(e,t){ajaxSetup(),$.ajax({url:config_apiserver+"api/rxmonitor/"+myval+"/"+e,type:"GET",contentType:"application/json;charset=utf-8",success:function(e){displayMonitorDetails(e,t)},error:function(){}})}function displayMonitorDetails(e,t){console.log(e),console.log(t);var i=new Date(e.StartDate),a=new Date(e.EndDate),r=e.Time;$("#txtFirstName").val(e.PatientFirstName),$("#txtLastName").val(e.PatientLastName);var o=new Date(e.PatientDateOfBirth);$("#txtAge").val(o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear()),$("#selectGender").val(e.PatientGender),$("#txtPatientId").val(e.PatientIdentifier),$("#txtComments").val(e.Comments),$("#txtMedKey").val(e.MedicineKey),$("#txtDeviceId").val(e.DeviceId),$("#txtFirstName").focus(),$("#patientName").html($("#txtFirstName").val()+" "+$("#txtLastName").val()),$("#patientNumber").html(e.PatientIdentifier),$("#dash").html(""==$("#patientName").html()||" "==$("#patientName").html()?"":" - "),null!=e.StartDate&&$("#startDate").val(i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()),null!=e.EndDate&&$("#endDate").val(a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear());for(var n=0;n<r.length;n++){var s='<div class="controls clockpicker-div col-md-2 added-time"><div class="input-group transparent clockpicker col-md-6"><input class="form-control clockpicker-input dosage-time" placeholder="time" type="text"><span class="input-group-addon"><i class="fa fa-clock-o"></i></span></div></div>';$(".dosage-time").last().val(r[n].Time.substring(0,r[n].Time.lastIndexOf(":"))),$(".dosage").append(s),6!=permission&&5!=permission&&0!=permission?$(".dosage-time").attr("disabled",!0):$(".clockpicker ").clockpicker({autoclose:!0})}console.log(t),"disabled"==t?(console.log(t),$("#btnDeactivate").hide(),$("#btnSaveEdit").hide()):$("#btnDeactivate").show()}function validateEdit(){var e=$("#txtComments").val(),t=$("#txtPatientId").val(),r=($("#txtMedName").val(),$("#txtDeviceId").val(),$("#txtAge").val());if(clearEditValidation(),t.length<2)return $("#lblPatientIdError").show(),$("#divPatientId").addClass("error-control"),!1;if(!isDate(r)&&""!=r)return $("#lblAgeError").show(),$("#lblAgeError").text("Make sure the date format is MM/DD/YYYY (ex: 02/18/1990)"),$("#lblAgeError").addClass("error-control"),!1;if(e.length<2&&0!=e.length)return $("#txtCommentsError").show(),$("#divMedicines").addClass("error-control"),!1;var n=($(".dosage-time-div"),!0);return $(".dosage-time-div").each(function(){var e=$(this).find("input");""!=e.val()&&(validateTime(e.val())||($("#timeError").show(),e.addClass("time-error"),e.next().addClass("time-error-span"),n=!1))}),n?!0:!1}function clearEditValidation(){$(".error-control").each(function(){$(this).removeClass("error-control")}),$("#lblFirstNameError").hide(),$("#divFirstName").removeClass("error-control"),$("#lblLastNameError").hide(),$("#divLastName").removeClass("error-control"),$("#lblAgeError").hide(),$("#divAge").removeClass("error-control"),$("#lblMedNameError").hide(),$("#divMedName").removeClass("error-control"),$("#lblDeviceIdError").hide(),$("#divDeviceId").removeClass("error-control"),$("#lblPatientIdError").hide(),$("#divPatientId").removeClass("error-control")}function editPrescription(){if(validateEditPrescription()){jQuery.support.cors=!0;var e={PrescriptionId:prid,OwnerId:$("#inputUserId").val(),AccountId:getParameterByName("aid"),DeviceId:$("#txtDeviceId").val(),MedicineId:1,PrescriptionDescription:$("#txtPrescDesc").val(),RxID:$("#txtRxid").val(),DrugManufacturer:$("#txtManufact").val(),Regimen:$("#txtRegimen").val(),StartDate:$("#txtStart").val(),EndDate:$("#txtEnd").val()};$.ajax({url:config_apiserver+"api/prescription/"+prid,type:"PUT",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",success:function(){$("#tblmonitors").dataTable().fnClearTable(),reloadTableHanlder($("#selectPrescriptionStatus").val()),showErrorMessage("Device successfully edited"),completeEdit()},error:function(){}})}}function saveEdit(){if(validateEdit()){$("#btnSaveEdit , #btnCancelEdit, #btnSaveEdit, #btnDeactivate").attr("disabled",!0);var e=myval,t=$("#txtFirstName").val(),i=$("#txtLastName").val(),a=$("#txtAge").val(),r=$("#selectGender").val(),o=$("#txtPatientId").val(),n=$("#txtComments").val(),s=$("#txtMedKey").val(),l=$("#txtDeviceId").val(),d=new Date($("#startDate").val()),c=new Date($("#endDate").val()),v=[],m=0;$(".dosage-time").each(function(){v[m]=$(this).val(),m++}),jQuery.support.cors=!0;var p={FirstName:t,LastName:i,Age:a,Gender:r,PatientId:o},u={Comments:n,MedicineKey:s,OwnerId:e,DeviceId:l,CreatedBy:e,StartDate:d,EndDate:c,StartDate:d,EndDate:c,Time:v};console.log(JSON.stringify({Patient:p,Monitor:u})),console.log(JSON.stringify({Patient:p,Monitor:u})),$.ajax(l.length>0?{url:config_apiserver+"api/device/bykey/"+l,contentType:"application/json;charset=utf-8",async:!1,success:function(t){return t.used?($("#lblDeviceIdError").show(),$("#lblDeviceIdError").text("This Device ID is already assigned"),void $("#divDeviceId").addClass("error-control")):void $.ajax({url:config_apiserver+"api/rxmonitor/"+e+"/"+editMonitorId,type:"PUT",data:JSON.stringify({Patient:p,Monitor:u}),contentType:"application/json;charset=utf-8",success:function(){console.log(editMonitorId),$("#tblmonitors").dataTable().fnClearTable(),reloadTableHandler($("#selectPrescriptionStatus").val()),showErrorMessage("Device successfully edited"),$("#btnSaveEdit , #btnCancel, #btnSave, #btnDeactivate").attr("disabled",!1),completeEdit()},error:function(){$("#btnSave , #btnCancel, #btnSave, #btnDeactivate").attr("disabled",!1),alert("Failed to edit the Device")}})},error:function(){$("#lblDeviceIdError").show(),$("#lblDeviceIdError").text("Device ID is not valid."),$("#divDeviceId").addClass("error-control")}}:{url:config_apiserver+"api/rxmonitor/"+e+"/"+editMonitorId,type:"PUT",data:JSON.stringify({Patient:p,Monitor:u}),contentType:"application/json;charset=utf-8",success:function(){console.log(editMonitorId),$("#tblmonitors").dataTable().fnClearTable(),reloadTableHandler($("#selectPrescriptionStatus").val()),showErrorMessage("Device successfully edited"),$("#btnSaveEdit , #btnCancel, #btnSave, #btnDeactivate").attr("disabled",!1),completeEdit()},error:function(){$("#btnSave , #btnCancel, #btnSave, #btnDeactivate").attr("disabled",!1),alert("Failed to edit the Device")}})}}function getEditMedicineDetails(e){$.ajax({url:config_apiserver+"api/medicine/"+e,type:"GET",contentType:"application/json;charset=utf-8",success:function(e){console.log(e),$("#txtMedDetails").val(e.MedicationLabDescription)},error:function(){}})}function completeEdit(){clearEditValidation(),$("#txtFirstName").val(""),$("#txtLastName").val(""),$("#txtAge").val(""),$("#txtPatientId").val(""),$("#txtDeviceId").val(""),$("#txtComments").val(""),$("#txtMedKey").val(""),$("#selectGender").val("male"),$("#patientModal").modal("hide"),$(".time-error").each(function(){$(this).removeClass("time-error"),$(this).next().removeClass("time-error-span")})}function validateDeviceId(e){return e.length<1?($("#lblDeviceIdError").show(),$("#lblDeviceIdError").text("Device ID is not valid."),$("#divDeviceId").addClass("error-control"),!1):void $.ajax({url:config_apiserver+"api/device/bykey/"+e,contentType:"application/json;charset=utf-8",async:!1,success:function(e){return e.used?($("#lblDeviceIdError").show(),$("#lblDeviceIdError").text("This Device ID is already assigned"),$("#divDeviceId").addClass("error-control"),!1):($("#lblDeviceIdError").hide(),void $("#divDeviceId").removeClass("error-control"))},error:function(){return $("#lblDeviceIdError").show(),$("#lblDeviceIdError").text("Device ID is not valid."),$("#divDeviceId").addClass("error-control"),!1}})}var tabsButtons=["profileBtn","prescriptionBtn","notificationsBtn","permissionsBtn"],modalViewed,monitorId,modalHeaderTxt;$("document").ready(function(){function e(e){0==tabsButtons.indexOf(e)?$("#modalPrev").hide():$("#modalPrev").show(),tabsButtons.indexOf(e)==tabsButtons.length-1?($("#modalNext").hide(),"edit"!=modalViewed&&$("#btnSaveEdit").show()):($("#modalNext").show(),"edit"!=modalViewed&&$("#btnSaveEdit").hide())}resetModal(),$(".clockpicker ").clockpicker({autoclose:!0}),$(".modal-buttons-header").live("click",function(){var t=$(".modal-buttons-header").find(".active").children().attr("id");e(t)}),$("#modalNext").live("click",function(){var t=$(".modal-buttons-header").find(".active").children().attr("id");$("#"+tabsButtons[tabsButtons.indexOf(t)+1]).click(),t=$(".modal-buttons-header").find(".active").children().attr("id"),e(t)}),$("#modalPrev").live("click",function(){var t=$(".modal-buttons-header").find(".active").children().attr("id");$("#"+tabsButtons[tabsButtons.indexOf(t)-1]).click(),t=$(".modal-buttons-header").find(".active").children().attr("id"),e(t)}),$("#btnSaveEdit").live("click",function(){"edit"==modalViewed?saveEdit():AddMonitor()}),$("#releaseDevice").live("click",function(){deleteMonitor(monitorId),completeEdit()}),$(".dosage-time").live("focusout",function(){var e='<div class="controls clockpicker-div col-md-2 added-time dosage-time-div"><div class="input-group transparent clockpicker col-md-6"><input class="form-control clockpicker-input dosage-time" placeholder="time" type="text"><span class="input-group-addon"><i class="fa fa-clock-o"></i></span></div></div>';$(".dosage-time").each(function(){""==$(this).val()&&$(this).parent().parent().remove()}),$(".dosage").append(e),$(".clockpicker").clockpicker({autoclose:!0})}),$(".remove-time").live("click",function(){$(this).parent().remove()}),$("#saveNotification").live("click",function(){addNotification($("#notificationType").val(),$("#notifyBy").val(),$("#recipient").val())}),$(".remove-notification").live("click",function(){$(this).parent().parent().remove()})});var editMonitorId=0;ajaxSetup(),$(document).ready(function(){$("#pEdit").live("click",function(){editMonitorId=$(this).data("id"),getMonitorDetails(editMonitorId,""),showModal($(this))}),$("#pEditArchived").live("click",function(){editMonitorId=$(this).data("id"),getMonitorDetails(editMonitorId,"disabled"),$("#modalEditMonitor").modal("show")}),$("#btnCancelEdit").click(function(){completeEdit()})}),$("#btnDeactivate").click(function(){deleteMonitor(editMonitorId),completeEdit()});